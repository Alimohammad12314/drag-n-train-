<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Drag n' Train</title>

  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <py-config>
    packages = ["pandas"]
  </py-config>

  <!-- FINAL, POLISHED STYLING -->
  <style>
    :root {
      --primary: #3b82f6; --primary-dark: #2563eb; --surface: #1f2937;
      --bg: #111827; --border: #374151; --text: #f9fafb; --muted: #9ca3af;
    }
    body { margin: 0; padding: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); }
    .container { max-width: 960px; margin: 2rem auto; padding: 2rem; }
    h1 { text-align: center; font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem; color: white;}
    h2 { border-bottom: 1px solid var(--border); padding-bottom: 0.5rem; margin-top: 2.5rem; }
    h3 { color: var(--primary); }
    label { display: flex; align-items: center; gap: 6px; margin: 1.5rem 0 0.5rem; font-weight: 600; color: var(--muted); }
    select, button, input[type="text"], textarea { 
      padding: 0.75rem; border-radius: 8px; border: 1px solid var(--border); 
      width: 100%; font-size: 1rem; background: #374151; color: var(--text); box-sizing: border-box;
    }
    textarea { resize: vertical; min-height: 60px; }
    button { 
      display: flex; align-items: center; justify-content: center; gap: 8px;
      background-color: var(--primary); color: white; font-weight: 600; border: none; margin-top: 1.5rem; cursor: pointer; transition: background-color 0.2s; 
    }
    button:hover:not(:disabled) { background-color: var(--primary-dark); }
    button:disabled { background-color: #4b5563; color: var(--muted); cursor: not-allowed; }
    .drop-zone { border: 2px dashed var(--border); border-radius: 12px; padding: 2rem; text-align: center; color: var(--muted); background: var(--surface); cursor: pointer; transition: 0.2s; }
    .drop-zone:hover, .drop-zone--over { background: #374151; border-color: var(--primary); }
    .drop-zone__input { display: none; }
    .results-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
    .result-card { background: var(--surface); padding: 1rem; border-radius: 8px; border: 1px solid var(--border); }
    .result-card table { width: 100%; border-collapse: collapse; margin-top: 0.5rem; }
    .result-card th, .result-card td { text-align: left; padding: 0.5rem; border-bottom: 1px solid var(--border); }
    .metrics-header-cell { display: flex; align-items: center; gap: 6px; }
    .result-card tr:last-child td, .result-card tr:last-child th { border-bottom: none; }
    .result-card img { max-width: 100%; border-radius: 6px; margin-top: 10px; background: white; padding: 5px;}
    .code-block { white-space: pre-wrap; word-wrap: break-word; background-color: #0d1117; color: #c9d1d9; padding: 1rem; border-radius: 8px; font-family: monospace; font-size: 0.9em; }
    #status { text-align: center; font-size: 1.2rem; font-weight: 600; margin-top: 2rem; }
    .help-icon { font-size: 0.8em; cursor: pointer; color: var(--muted); border: 1px solid var(--muted); border-radius: 50%; width: 16px; height: 16px; display: inline-flex; justify-content: center; align-items: center; flex-shrink: 0;}
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 1000; }
    .modal-content { background: var(--surface); padding: 2rem; border-radius: 12px; max-width: 500px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border: 1px solid var(--border);}
    .modal h2 { margin-top: 0; }
    .ai-summary, .ai-suggestion { font-style: italic; color: var(--muted); }
    .faq-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 1rem; }
    .faq-item { cursor: pointer; background: #374151; padding: 8px 12px; border-radius: 20px; font-size: 0.9em; transition: 0.2s; }
    .faq-item:hover { background-color: var(--primary); color: white; }
    .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    .knowledge-base-search { display: flex; gap: 10px; margin-top: 1rem; }
    .tagline { text-align: center; font-size: 1.25rem; color: var(--muted); margin-bottom: 2.5rem; }
    #welcome-modal-content { text-align: center; }
  </style>
</head>

<body>
  <div class="container">
    <h1>Drag n' Train</h1>
    <!-- NEW: Tagline -->
    <p class="tagline">From Dataset to Decision, Instantly.</p>
    
    <div id="ai-suggestion-card" class="result-card ai-suggestion" style="display:none;"></div>
    <div id="data-profile-card" class="result-card" style="display:none; max-height: 400px; overflow-y: auto;"></div>
    <label>1. Upload CSV File</label>
    <div class="drop-zone" id="drop-zone">
      <span class="drop-zone__prompt" style="display: flex; align-items: center; justify-content: center; gap: 10px;">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
        <span>Drag & Drop CSV here or click to browse</span>
      </span>
      <input type="file" id="file-upload-input" class="drop-zone__input" accept=".csv">
    </div>
    <div id="objective-section" style="display:none; margin-top: 1rem;">
      <label for="user-objective">What is your main objective with this data?</label>
      <textarea id="user-objective" placeholder="e.g., 'I want to predict the price' or 'find out which customers might leave'"></textarea>
    </div>
    <div class="button-grid" id="action-buttons" style="display:none;">
      <button id="profile-button" style="margin-top: 1rem; background-color: #57534e;">Profile Dataset</button>
      <button id="suggest-button" style="margin-top: 1rem; background-color: #16a34a;">Suggest Model</button>
    </div>
    <div id="controls-section" style="display:none;" class="result-card">
        <label>2. Choose Problem Type <span id="help-problem-type" class="help-icon">?</span></label>
        <select id="problem-type"><option disabled selected value="">-- Select --</option><option value="regression">Regression</option><option value="classification">Classification</option></select>
        <label>3. Choose Target Column <span id="help-target-column" class="help-icon">?</span></label>
        <select id="target-column" disabled><option>Upload CSV first</option></select>
        <label>4. Choose Model</label>
        <select id="model-name" disabled><option>Choose problem type first</option></select>
        <button id="train-button" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>
            <span>Train Model</span>
        </button>
    </div>
    <div id="results">
      <p id="status"></p>
      <div class="results-grid">
        <div class="results-column" id="results-col-1" style="display: flex; flex-direction: column; gap: 1.5rem;"></div>
        <div class="results-column" id="results-col-2" style="display: flex; flex-direction: column; gap: 1.5rem;"></div>
      </div>
      <div id="comparison-section" class="result-card" style="display:none; margin-top: 1.5rem;"></div>
      <div class="button-grid">
          <button id="download-report-button" style="display:none; margin-top: 1rem; background-color: #be123c;">Download Report</button>
          <button id="package-model-button" style="display:none; margin-top: 1rem; background-color: #4338ca;">Package as API</button>
      </div>
    </div>
    <div id="knowledge-base-section">
      <h2>ML Knowledge Base</h2>
      <div class="knowledge-base-search">
        <input type="text" id="kb-search-input" placeholder="Enter a term (e.g., Overfitting)">
        <button id="kb-search-button" style="margin-top: 0;">Explain</button>
      </div>
      <div class="faq-grid" id="faq-grid"></div>
    </div>
  </div>

  <div id="ai-modal" class="modal"><div class="modal-content"><h2 id="modal-title">Explanation</h2><p id="modal-body">Loading...</p></div></div>
  <a id="download-link" style="display: none;"></a>
  
  <!-- NEW: Welcome Modal HTML -->
  <div id="welcome-modal" class="modal">
      <div id="welcome-modal-content" class="modal-content">
          <h2 style="color: var(--primary);">Welcome to Drag n' Train!</h2>
          <p class="tagline" style="margin-bottom: 1rem;">From Dataset to Decision, Instantly.</p>
          <p style="color: var(--muted);">
            This tool is a complete machine learning playground. Just upload a dataset, get suggestions from our AI assistant, and train models to analyze your dataâ€”all without writing a single line of code.
          </p>
          <button id="close-welcome-button" style="margin-top: 1.5rem;">Get Started</button>
      </div>
  </div>

  <py-script src="./frontend.py"></py-script>

</body>
</html>